{{- if .Values.instrumentation.enabled }}
---
apiVersion: opentelemetry.io/v1alpha1
kind: Instrumentation
metadata:
  name: {{ include "opentelemetry-collector.instrumentation" . }}
  labels:
    {{- include "opentelemetry-kube-stack.labels" $ | nindent 4 }}
    {{- with .Values.instrumentation.labels }}
    {{- range $key, $value := . }}
    {{- printf "%s: %s" $key (tpl $value $ | quote) | nindent 4 }}
    {{- end }}
    {{- end }}
  {{- with .Values.instrumentation.annotations }}
  annotations:
    {{- range $key, $value := . }}
    {{- printf "%s: %s" $key (tpl $value $ | quote) | nindent 4 }}
    {{- end }}
  {{- end }}
spec:
  exporter:
    endpoint: {{ .Values.instrumentation.exporter.endpoint }}
  propagators:
    {{- toYaml .Values.instrumentation.propagators | nindent 4 }}
  {{- with .Values.instrumentation.sampler }}
  sampler:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  env:
    {{- with $.Values.extraEnvs }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
    {{- with .Values.instrumentation.env }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .Values.instrumentation.resource }}
  resource:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  {{- with .Values.instrumentation.java }}
  java:
    {{- toYaml . | nindent 4}}
  {{- end }}
  {{- with .Values.instrumentation.nodejs }}
  nodejs:
    {{- toYaml . | nindent 4}}
  {{- end }}
  {{- with .Values.instrumentation.python }}
  python:
    {{- toYaml . | nindent 4}}
  {{- end }}
  {{- with .Values.instrumentation.dotnet }}
  dotnet:
    {{- toYaml . | nindent 4}}
  {{- end }}
  {{- with .Values.instrumentation.go }}
  go:
    {{- toYaml . | nindent 4}}
  {{- end }}
  {{- with .Values.instrumentation.apacheHttpd }}
  apacheHtpd:
  {{- toYaml . | nindent 4 }}
  {{- end }}
  {{- with .Values.instrumentation.nginx }}
  nginx:
    {{- toYaml . | nindent 4}}
  {{- end }}
{{- end }}
